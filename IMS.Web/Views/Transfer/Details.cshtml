@model IMS.Application.DTOs.TransferDto
@{
    ViewData["Title"] = "Transfer Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Content Header -->
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0">Transfer Details - @Model.TransferNo</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Home</a></li>
                    <li class="breadcrumb-item"><a asp-action="Index">Transfers</a></li>
                    <li class="breadcrumb-item active">Details</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<!-- Main content -->
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Transfer Information</h3>
                        <div class="card-tools">
                            <a asp-action="Print" asp-route-id="@Model.Id" class="btn btn-success btn-sm" target="_blank">
                                <i class="fas fa-print"></i> Print
                            </a>
                            <a asp-action="Index" class="btn btn-secondary btn-sm">
                                <i class="fas fa-arrow-left"></i> Back to List
                            </a>
                        </div>
                    </div>
                    <div class="card-body">
                        <dl class="row">
                            <dt class="col-sm-3">Transfer No:</dt>
                            <dd class="col-sm-9"><strong>@Model.TransferNo</strong></dd>

                            <dt class="col-sm-3">Status:</dt>
                            <dd class="col-sm-9">
                                @{
                                    var statusBadgeClass = Model.Status switch
                                    {
                                        "Draft" => "badge-secondary",
                                        "Approved" => "badge-primary",
                                        "In Transit" => "badge-warning",
                                        "Completed" => "badge-success",
                                        "Cancelled" => "badge-danger",
                                        _ => "badge-info"
                                    };
                                }
                                <span class="badge @statusBadgeClass" style="font-size: 1.1em;">
                                    @Model.Status
                                </span>
                            </dd>

                            <dt class="col-sm-3">Transfer Date:</dt>
                            <dd class="col-sm-9">@Model.TransferDate.ToString("dd-MMM-yyyy")</dd>

                            <dt class="col-sm-3">From Store:</dt>
                            <dd class="col-sm-9">
                                <a asp-controller="Store" asp-action="Details" asp-route-id="@Model.FromStoreId">
                                    <i class="fas fa-store text-info"></i> @Model.FromStoreName
                                </a>
                            </dd>

                            <dt class="col-sm-3">To Store:</dt>
                            <dd class="col-sm-9">
                                <a asp-controller="Store" asp-action="Details" asp-route-id="@Model.ToStoreId">
                                    <i class="fas fa-store text-success"></i> @Model.ToStoreName
                                </a>
                            </dd>

                            @if (!string.IsNullOrEmpty(Model.Remarks))
                            {
                                <dt class="col-sm-3">Remarks:</dt>
                                <dd class="col-sm-9">@Model.Remarks</dd>
                            }

                            <dt class="col-sm-3">Created By:</dt>
                            <dd class="col-sm-9">@Model.CreatedBy</dd>

                            <dt class="col-sm-3">Created At:</dt>
                            <dd class="col-sm-9">@Model.CreatedAt.ToString("dd-MMM-yyyy HH:mm")</dd>
                        </dl>
                    </div>
                </div>

                <!-- Transferred Items -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Transferred Items</h3>
                    </div>
                    <div class="card-body">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Quantity</th>
                                    <th>Unit</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.Items)
                                {
                                    <tr>
                                        <td>
                                            <a asp-controller="Item" asp-action="Details" asp-route-id="@item.ItemId">
                                                @item.ItemName
                                            </a>
                                        </td>
                                        <td>@item.Quantity</td>
                                        <td>pcs</td>
                                    </tr>
                                }
                            </tbody>
                            <tfoot>
                                <tr>
                                    <th>Total Items:</th>
                                    <th colspan="2">@Model.Items.Count</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card card-info">
                    <div class="card-header">
                        <h3 class="card-title">Transfer Summary</h3>
                    </div>
                    <div class="card-body">
                        <div class="info-box bg-primary">
                            <span class="info-box-icon"><i class="fas fa-boxes"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text">Total Items</span>
                                <span class="info-box-number">@Model.Items.Count</span>
                            </div>
                        </div>
                        <div class="info-box bg-success">
                            <span class="info-box-icon"><i class="fas fa-calculator"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text">Total Quantity</span>
                                <span class="info-box-number">@Model.Items.Sum(i => i.Quantity)</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card card-warning">
                    <div class="card-header">
                        <h3 class="card-title">Actions</h3>
                    </div>
                    <div class="card-body">
                        @if (Model.Status == "Draft")
                        {
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i> This transfer is awaiting approval
                            </div>
                        }

                        @if (Model.Status == "Approved")
                        {
                            <form asp-action="Dispatch" method="post" style="display: inline;">
                                <button type="submit" class="btn btn-block btn-warning" onclick="return confirm('Dispatch this transfer?')">
                                    <i class="fas fa-truck"></i> Dispatch Transfer
                                </button>
                            </form>
                        }

                        @if (Model.Status == "In Transit")
                        {
                            <a asp-action="Receive" asp-route-id="@Model.Id" class="btn btn-block btn-success">
                                <i class="fas fa-check-circle"></i> Receive Transfer
                            </a>
                        }

                        @if (Model.Status == "Completed")
                        {
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle"></i> This transfer has been completed
                            </div>
                        }

                        <hr />

                        <a asp-action="Create" class="btn btn-block btn-primary">
                            <i class="fas fa-plus"></i> Create New Transfer
                        </a>
                        <a asp-action="ByStore" asp-route-storeId="@Model.FromStoreId" asp-route-type="from" class="btn btn-block btn-info">
                            <i class="fas fa-arrow-up"></i> Outgoing from @Model.FromStoreName
                        </a>
                        <a asp-action="ByStore" asp-route-storeId="@Model.ToStoreId" asp-route-type="to" class="btn btn-block btn-info">
                            <i class="fas fa-arrow-down"></i> Incoming to @Model.ToStoreName
                        </a>
                        <a asp-action="Track" asp-route-code="@Model.TransferNo" class="btn btn-block btn-secondary">
                            <i class="fas fa-map-marker-alt"></i> Track Transfer
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
