@model IMS.Application.DTOs.BarcodeDto
@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Print Barcode - @Model.BarcodeNumber</title>

    <link rel="stylesheet" href="~/adminlte/plugins/fontawesome-free/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f4f6f9;
            padding: 20px;
        }

        .print-wrapper {
            max-width: 800px;
            margin: 0 auto;
        }

        .no-print {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .print-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #007bff;
        }

            .print-header h2 {
                color: #007bff;
                font-size: 24px;
            }

            .print-header .timestamp {
                color: #6c757d;
                font-size: 14px;
            }

        .print-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

            .option-group label {
                font-weight: 600;
                color: #495057;
                font-size: 14px;
            }

            .option-group select,
            .option-group input {
                padding: 8px 12px;
                border: 1px solid #ced4da;
                border-radius: 4px;
                font-size: 14px;
            }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

            .checkbox-option input[type="checkbox"] {
                width: 18px;
                height: 18px;
            }

        .print-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

            .btn-primary:hover {
                background: #0056b3;
            }

        .btn-success {
            background: #28a745;
            color: white;
        }

            .btn-success:hover {
                background: #218838;
            }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

            .btn-secondary:hover {
                background: #5a6268;
            }

        .label-container {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .label-inner {
            border: 3px solid #007bff;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            background: white;
        }

        .qr-section {
            margin: 20px 0;
        }

            .qr-section img {
                border: 2px solid #e9ecef;
                border-radius: 8px;
                padding: 10px;
                background: white;
                max-width: 250px;
            }

        .barcode-number {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
            letter-spacing: 2px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }

        .item-name {
            font-size: 20px;
            color: #34495e;
            font-weight: 500;
            margin: 10px 0;
        }

        .serial-info {
            font-size: 16px;
            color: #7f8c8d;
            margin: 8px 0;
        }

        .store-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .info-label {
            font-weight: 600;
            color: #495057;
        }

        .info-value {
            color: #6c757d;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .badge-success {
            background: #28a745;
            color: white;
        }

        .badge-primary {
            background: #007bff;
            color: white;
        }

        .footer-info {
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #dee2e6;
            color: #6c757d;
            font-size: 12px;
        }

        @@media print {
            body

        {
            background: white;
            padding: 0;
        }

        .no-print {
            display: none !important;
        }

        .print-wrapper {
            max-width: 100%;
        }

        .label-container {
            box-shadow: none;
            padding: 20px;
        }

        .page-break {
            page-break-after: always;
        }

        }

        @@media (max-width: 768px) {
            .print-options

        {
            grid-template-columns: 1fr;
        }

        .print-controls {
            flex-direction: column;
        }

        .btn {
            width: 100%;
            justify-content: center;
        }

        }
    </style>
</head>
<body>
    <div class="print-wrapper">
        <div class="no-print">
            <div class="print-header">
                <h2><i class="fas fa-barcode"></i> Barcode Print Preview</h2>
                <div class="timestamp">
                    <i class="fas fa-clock"></i> @DateTime.Now.ToString("MMM dd, yyyy - hh:mm tt")
                </div>
            </div>

            <div class="print-options">
                <div class="option-group">
                    <label><i class="fas fa-ruler"></i> Label Size</label>
                    <select id="labelSize" onchange="changeLabelSize()">
                        <option value="standard">Standard</option>
                        <option value="large">Large</option>
                        <option value="small">Small</option>
                    </select>
                </div>

                <div class="option-group">
                    <label><i class="fas fa-copy"></i> Number of Copies</label>
                    <input type="number" id="copies" value="1" min="1" max="10" onchange="updateCopies()">
                </div>

                <div class="option-group">
                    <div class="checkbox-option">
                        <input type="checkbox" id="showStore" checked onchange="toggleStore()">
                        <label>Show Store Info</label>
                    </div>
                </div>

                <div class="option-group">
                    <div class="checkbox-option">
                        <input type="checkbox" id="showTimestamp" onchange="toggleTimestamp()">
                        <label>Show Print Time</label>
                    </div>
                </div>
            </div>

            <div class="print-controls">
                <button type="button" class="btn btn-primary" onclick="printLabel()">
                    <i class="fas fa-print"></i> Print Label
                </button>
                <a href="@Url.Action("GeneratePDF", new { id = Model.Id })" class="btn btn-success">
                    <i class="fas fa-file-pdf"></i> Download PDF
                </a>
                <a href="@Url.Action("Details", new { id = Model.Id })" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Details
                </a>
                <button type="button" class="btn btn-secondary" onclick="window.close()">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>

        <div id="labelsContainer">
            <div class="label-container" id="mainLabel">
                <div class="label-inner">
                    <div class="qr-section">
                        @if (!string.IsNullOrEmpty(ViewBag.QRCodeBase64))
                        {
                            <img src="data:image/png;base64,@ViewBag.QRCodeBase64" alt="QR Code" id="qrImage">
                        }
                        else
                        {
                            <div style="width: 250px; height: 250px; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                                <span style="color: #999;">QR Code Not Available</span>
                            </div>
                        }
                    </div>

                    <div class="barcode-number">@Model.BarcodeNumber</div>
                    <div class="item-name">@Model.ItemName</div>

                    @if (!string.IsNullOrEmpty(Model.SerialNumber))
                    {
                        <div class="serial-info"><strong>Serial:</strong> @Model.SerialNumber</div>
                    }

                    @if (!string.IsNullOrEmpty(Model.BatchNumber))
                    {
                        <div class="serial-info"><strong>Batch:</strong> @Model.BatchNumber</div>
                    }

                    <div class="store-section" id="storeSection">
                        @if (!string.IsNullOrEmpty(Model.StoreName) || !string.IsNullOrEmpty(Model.Location))
                        {
                            @if (!string.IsNullOrEmpty(Model.StoreName))
                            {
                                <div class="info-row">
                                    <span class="info-label">Store:</span>
                                    <span class="info-value">@Model.StoreName</span>
                                </div>
                            }
                            @if (!string.IsNullOrEmpty(Model.Location))
                            {
                                <div class="info-row">
                                    <span class="info-label">Location:</span>
                                    <span class="info-value">@Model.Location</span>
                                </div>
                            }
                        }
                        else
                        {
                            <div class="info-row">
                                <span class="info-value">No store information available</span>
                            </div>
                        }
                    </div>

                    <div style="margin-top: 15px;">
                        <div class="info-row">
                            <span class="info-label">Type:</span>
                            <span class="info-value">
                                <span class="badge badge-@(Model.BarcodeType == "QRCode" ? "success" : "primary")">
                                    @(Model.BarcodeType ?? "Barcode")
                                </span>
                            </span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Generated:</span>
                            <span class="info-value">@Model.GeneratedDate.ToString("MMM dd, yyyy")</span>
                        </div>
                        @if (!string.IsNullOrEmpty(Model.ItemCode))
                        {
                            <div class="info-row">
                                <span class="info-label">Item Code:</span>
                                <span class="info-value">@Model.ItemCode</span>
                            </div>
                        }
                        @if (!string.IsNullOrEmpty(Model.CategoryName))
                        {
                            <div class="info-row">
                                <span class="info-label">Category:</span>
                                <span class="info-value">@Model.CategoryName</span>
                            </div>
                        }
                    </div>

                    <div id="printTimestamp" style="display: none; margin-top: 15px; color: #6c757d; font-size: 12px;">
                        <i class="fas fa-print"></i> Printed: @DateTime.Now.ToString("MMM dd, yyyy - hh:mm tt")
                    </div>

                    <div class="footer-info">
                        <strong>IMS - Inventory Management System</strong><br>
                        Barcode ID: #@Model.Id | @Model.BarcodeNumber
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function printLabel() {
            recordPrintAction();
            window.print();
        }

        function changeLabelSize() {
            const size = document.getElementById('labelSize').value;
            const qrImage = document.getElementById('qrImage');
            const labelInner = document.querySelector('.label-inner');

            if (!qrImage || !labelInner) return;

            switch(size) {
                case 'large':
                    qrImage.style.maxWidth = '300px';
                    labelInner.style.padding = '40px';
                    break;
                case 'small':
                    qrImage.style.maxWidth = '150px';
                    labelInner.style.padding = '20px';
                    break;
                default: // standard
                    qrImage.style.maxWidth = '250px';
                    labelInner.style.padding = '30px';
            }
        }

        function updateCopies() {
            const copies = parseInt(document.getElementById('copies').value) || 1;
            const container = document.getElementById('labelsContainer');
            const mainLabel = document.getElementById('mainLabel');

            const existingCopies = container.querySelectorAll('.label-copy');
            existingCopies.forEach(copy => copy.remove());

            for (let i = 1; i < copies; i++) {
                const copy = mainLabel.cloneNode(true);
                copy.id = 'label-copy-' + i;
                copy.classList.add('label-copy');
                if (i % 2 === 0) {
                    copy.classList.add('page-break');
                }
                container.appendChild(copy);
            }
        }

        function toggleStore() {
            const storeSection = document.querySelectorAll('#storeSection, .store-section');
            const checked = document.getElementById('showStore').checked;
            storeSection.forEach(section => {
                section.style.display = checked ? 'block' : 'none';
            });
        }

        function toggleTimestamp() {
            const timestamp = document.querySelectorAll('#printTimestamp');
            const checked = document.getElementById('showTimestamp').checked;
            timestamp.forEach(ts => {
                ts.style.display = checked ? 'block' : 'none';
            });
        }

        function recordPrintAction() {
            fetch('@Url.Action("RecordPrint", "Barcode")', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ barcodeId: @Model.Id })
            }).catch(err => console.log('Print tracking failed:', err));
        }

        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault();
                printLabel();
            }
        });
    </script>
</body>
</html>