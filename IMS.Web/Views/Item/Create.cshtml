@model IMS.Application.DTOs.ItemDto
@{
    ViewData["Title"] = "Create New Item";
}

<!-- Content Header -->
<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1>
                    <i class="fas fa-plus-circle text-success"></i> Create New Item
                </h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="@Url.Action("Index", "Home")">Home</a></li>
                    <li class="breadcrumb-item"><a href="@Url.Action("Index", "Item")">Items</a></li>
                    <li class="breadcrumb-item active">Create</li>
                </ol>
            </div>
        </div>
    </div>
</section>

<!-- Main content -->
<section class="content">
    <div class="container-fluid">
        <form asp-action="Create" method="post" enctype="multipart/form-data" id="createItemForm">
            <div class="row">
                <!-- Left Column -->
                <div class="col-md-8">
                    <!-- Basic Information Card -->
                    <div class="card card-success card-outline">
                        <div class="card-header">
                            <h3 class="card-title text-white">
                                <i class="fas fa-info-circle"></i> Basic Information
                            </h3>
                            <div class="card-tools">
                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                    <i class="fas fa-minus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert" style="display:none;"></div>

                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label asp-for="ItemCode" class="control-label">
                                            <i class="fas fa-barcode text-primary"></i> Item Code
                                        </label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text bg-light">
                                                    <i class="fas fa-hashtag"></i>
                                                </span>
                                            </div>
                                            <input asp-for="ItemCode" class="form-control" readonly placeholder="Auto-generated" />
                                        </div>
                                        <small class="text-muted">Will be generated automatically</small>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="form-group">
                                        <label asp-for="Name" class="control-label">
                                            <i class="fas fa-tag text-primary"></i> Item Name <span class="text-danger">*</span>
                                        </label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                    <i class="fas fa-box"></i>
                                                </span>
                                            </div>
                                            <input asp-for="Name" class="form-control" placeholder="Enter item name" required />
                                        </div>
                                        <span asp-validation-for="Name" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="NameBn" class="control-label">
                                            <i class="fas fa-language text-primary"></i> Item Name (Bengali)
                                        </label>
                                        <input asp-for="NameBn" class="form-control" placeholder="বাংলা নাম" />
                                        <span asp-validation-for="NameBn" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="Code" class="control-label">
                                            <i class="fas fa-code text-primary"></i> Alternative Code
                                        </label>
                                        <input asp-for="Code" class="form-control" placeholder="Alternative item code" />
                                        <span asp-validation-for="Code" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label asp-for="Description" class="control-label">
                                            <i class="fas fa-align-left text-primary"></i> Description
                                        </label>
                                        <textarea asp-for="Description" class="form-control" rows="3" placeholder="Enter detailed description..."></textarea>
                                        <span asp-validation-for="Description" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="Manufacturer" class="control-label">
                                            <i class="fas fa-industry text-info"></i> Manufacturer
                                        </label>
                                        <input asp-for="Manufacturer" class="form-control" placeholder="Manufacturer Name" />
                                        <span asp-validation-for="Manufacturer" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="ManufactureDate" class="control-label">
                                            <i class="fas fa-calendar text-info"></i> Manufacture Date
                                        </label>
                                        <input asp-for="ManufactureDate" type="date" class="form-control" />
                                        <span asp-validation-for="ManufactureDate" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <!-- NEW: Serial Number Field -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="SerialNumber" class="control-label">
                                            <i class="fas fa-hashtag text-secondary"></i> Serial Number
                                        </label>
                                        <input asp-for="SerialNumber" class="form-control" placeholder="Enter serial number" />
                                        <span asp-validation-for="SerialNumber" class="text-danger"></span>
                                        <small class="text-muted">For non-expendable items tracking</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Classification Card -->
                    <div class="card card-info card-outline">
                        <div class="card-header">
                            <h3 class="card-title text-white">
                                <i class="fas fa-sitemap"></i> Classification
                            </h3>
                            <div class="card-tools">
                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                    <i class="fas fa-minus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="CategoryId" class="control-label">
                                            <i class="fas fa-layer-group text-info"></i> Category <span class="text-danger">*</span>
                                        </label>
                                        <select asp-for="CategoryId" id="CategoryId" class="form-control select2" asp-items="ViewBag.Categories" data-placeholder="Select Category" required>
                                            <option value="">-- Select Category --</option>
                                        </select>
                                        <span asp-validation-for="CategoryId" class="text-danger" id="CategoryError"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="SubCategoryId" class="control-label">
                                            <i class="fas fa-stream text-info"></i> Sub Category
                                        </label>
                                        <select asp-for="SubCategoryId" id="SubCategoryId" class="form-control select2" data-placeholder="Select Sub Category">
                                            <option value="">-- Select Sub Category --</option>
                                        </select>
                                        <span asp-validation-for="SubCategoryId" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="BrandId" class="control-label">
                                            <i class="fas fa-award text-info"></i> Brand
                                        </label>
                                        <select asp-for="BrandId" id="BrandId" class="form-control select2" asp-items="ViewBag.Brands" data-placeholder="Select Brand">
                                            <option value="">-- Select Brand --</option>
                                        </select>
                                        <span asp-validation-for="BrandId" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="ItemModelId" class="control-label">
                                            <i class="fas fa-cogs text-info"></i> Model
                                        </label>
                                        <select asp-for="ItemModelId" id="ItemModelId" class="form-control select2" data-placeholder="Select Model">
                                            <option value="">-- Select Model --</option>
                                        </select>
                                        <span asp-validation-for="ItemModelId" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Stock Management Card -->
                    <div class="card card-success card-outline">
                        <div class="card-header">
                            <h3 class="card-title text-white">
                                <i class="fas fa-warehouse"></i> Stock Management
                            </h3>
                            <div class="card-tools">
                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                    <i class="fas fa-minus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label asp-for="Type" class="control-label">
                                            <i class="fas fa-cube text-success"></i> Item Type <span class="text-danger">*</span>
                                        </label>
                                        <select asp-for="Type" class="form-control select2" asp-items="ViewBag.ItemTypes" required>
                                            <option value="">-- Select Type --</option>
                                        </select>
                                        <span asp-validation-for="Type" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label asp-for="Unit" class="control-label">
                                            <i class="fas fa-balance-scale text-success"></i> Unit <span class="text-danger">*</span>
                                        </label>
                                        <select asp-for="Unit" class="form-control" required>
                                            <option value="">Select Unit</option>
                                            <option value="Piece">Piece</option>
                                            <option value="Box">Box</option>
                                            <option value="Pack">Pack</option>
                                            <option value="Set">Set</option>
                                            <option value="Kg">Kilogram</option>
                                            <option value="Gram">Gram</option>
                                            <option value="Liter">Liter</option>
                                            <option value="Meter">Meter</option>
                                            <option value="Dozen">Dozen</option>
                                            <option value="Roll">Roll</option>
                                            <option value="Bundle">Bundle</option>
                                        </select>
                                        <span asp-validation-for="Unit" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label asp-for="MinimumStock" class="control-label">
                                            <i class="fas fa-exclamation-triangle text-warning"></i> Min Stock <span class="text-danger">*</span>
                                        </label>
                                        <input asp-for="MinimumStock" class="form-control" type="number" min="0" step="0.001" value="0" required />
                                        <span asp-validation-for="MinimumStock" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label asp-for="MaximumStock" class="control-label">
                                            <i class="fas fa-arrow-up text-info"></i> Max Stock
                                        </label>
                                        <input asp-for="MaximumStock" class="form-control" type="number" min="0" step="0.001" />
                                        <span asp-validation-for="MaximumStock" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label asp-for="ReorderLevel" class="control-label">
                                            <i class="fas fa-sync text-primary"></i> Reorder Level
                                        </label>
                                        <input asp-for="ReorderLevel" class="form-control" type="number" min="0" step="0.001" />
                                        <span asp-validation-for="ReorderLevel" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label asp-for="UnitPrice" class="control-label">
                                            <i class="fas fa-dollar-sign text-success"></i> Unit Price
                                        </label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">৳</span>
                                            </div>
                                            <input asp-for="UnitPrice" class="form-control" type="number" min="0" step="0.01" />
                                        </div>
                                        <span asp-validation-for="UnitPrice" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label asp-for="UnitCost" class="control-label">
                                            <i class="fas fa-dollar-sign text-info"></i> Unit Cost
                                        </label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">৳</span>
                                            </div>
                                            <input asp-for="UnitCost" class="form-control" type="number" min="0" step="0.01" />
                                        </div>
                                        <span asp-validation-for="UnitCost" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label asp-for="Location" class="control-label">
                                            <i class="fas fa-map-marker-alt text-danger"></i> Storage Location
                                        </label>
                                        <input asp-for="Location" class="form-control" placeholder="e.g., Rack A, Shelf 3" />
                                        <span asp-validation-for="Location" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <!-- Item Control & Authorization -->
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label asp-for="ItemControlType" class="control-label">
                                            <i class="fas fa-shield-alt text-info"></i> Control Type
                                        </label>
                                        <select asp-for="ItemControlType" class="form-control">
                                            <option value="">Not Specified</option>
                                            <option value="Controlled">Controlled</option>
                                            <option value="Uncontrolled">Uncontrolled</option>
                                        </select>
                                        <small class="form-text text-muted">Controlled items require personnel tracking</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="control-label">
                                            <i class="fas fa-users text-primary"></i> Authorization
                                        </label>
                                        <div class="custom-control custom-checkbox">
                                            <input asp-for="IsAnsarAuthorized" type="checkbox" class="custom-control-input" id="IsAnsarAuthorized" checked>
                                            <label class="custom-control-label" for="IsAnsarAuthorized">Ansar</label>
                                        </div>
                                        <div class="custom-control custom-checkbox">
                                            <input asp-for="IsVDPAuthorized" type="checkbox" class="custom-control-input" id="IsVDPAuthorized" checked>
                                            <label class="custom-control-label" for="IsVDPAuthorized">VDP</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Ansar Lifespan Configuration -->
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="alert alert-success">
                                        <h6><i class="fas fa-user-shield"></i> <strong>Ansar Personnel Lifespan Settings</strong></h6>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="AnsarLifeSpanMonths" class="control-label">
                                            <i class="fas fa-clock text-primary"></i> Ansar Life Span (Months)
                                        </label>
                                        <input asp-for="AnsarLifeSpanMonths" class="form-control" type="number" min="1" max="120" placeholder="e.g., 12" />
                                        <small class="form-text text-muted">Service life in months for Ansar personnel</small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="AnsarAlertBeforeDays" class="control-label">
                                            <i class="fas fa-bell text-primary"></i> Ansar Alert Before (Days)
                                        </label>
                                        <input asp-for="AnsarAlertBeforeDays" class="form-control" type="number" min="1" max="90" value="30" placeholder="30" />
                                        <small class="form-text text-muted">Alert before expiry for Ansar</small>
                                    </div>
                                </div>
                            </div>

                            <!-- VDP Lifespan Configuration -->
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="alert alert-secondary">
                                        <h6><i class="fas fa-users"></i> <strong>VDP Personnel Lifespan Settings</strong></h6>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="VDPLifeSpanMonths" class="control-label">
                                            <i class="fas fa-clock text-secondary"></i> VDP Life Span (Months)
                                        </label>
                                        <input asp-for="VDPLifeSpanMonths" class="form-control" type="number" min="1" max="120" placeholder="e.g., 6" />
                                        <small class="form-text text-muted">Service life in months for VDP personnel</small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="VDPAlertBeforeDays" class="control-label">
                                            <i class="fas fa-bell text-secondary"></i> VDP Alert Before (Days)
                                        </label>
                                        <input asp-for="VDPAlertBeforeDays" class="form-control" type="number" min="1" max="90" value="30" placeholder="30" />
                                        <small class="form-text text-muted">Alert before expiry for VDP</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Master Catalogue Register -->
                    <div class="card card-info card-outline">
                        <div class="card-header">
                            <h3 class="card-title text-white">
                                <i class="fas fa-book"></i> Master Catalogue Register (মাস্টার ক্যাটালগ রেজিস্টার)
                            </h3>
                            <div class="card-tools">
                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                    <i class="fas fa-minus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i>
                                <strong>নোট:</strong> এই তথ্যগুলো Master Stock Register এর জন্য। প্রথমবার Item কেন্দ্রীয় ভান্ডারে গ্রহণের সময় এন্ট্রি করুন।
                            </div>

                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label asp-for="CatalogueLedgerNo" class="control-label">
                                            <i class="fas fa-bookmark text-info"></i> লেজার নং
                                        </label>
                                        <input asp-for="CatalogueLedgerNo" class="form-control" placeholder="e.g., CAT-UC" maxlength="10" />
                                        <small class="text-muted">Master Register Ledger Number</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label asp-for="CataloguePageNo" class="control-label">
                                            <i class="fas fa-file text-info"></i> পাতা নং
                                        </label>
                                        <input asp-for="CataloguePageNo" class="form-control" placeholder="e.g., 14" maxlength="10" />
                                        <small class="text-muted">Master Register Page Number</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label asp-for="CatalogueEntryDate" class="control-label">
                                            <i class="fas fa-calendar-plus text-info"></i> ক্যাটালগ এন্ট্রি তারিখ
                                        </label>
                                        <input asp-for="CatalogueEntryDate" type="date" class="form-control" />
                                        <small class="text-muted">Catalogue Entry Date</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label asp-for="FirstReceivedDate" class="control-label">
                                            <i class="fas fa-calendar-check text-info"></i> প্রথম গ্রহণের তারিখ
                                        </label>
                                        <input asp-for="FirstReceivedDate" type="date" class="form-control" />
                                        <small class="text-muted">First Received Date</small>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label asp-for="CatalogueRemarks" class="control-label">
                                            <i class="fas fa-comment text-info"></i> মন্তব্য
                                        </label>
                                        <textarea asp-for="CatalogueRemarks" class="form-control" rows="2" placeholder="Optional remarks for catalogue entry" maxlength="500"></textarea>
                                        <small class="text-muted">Optional notes/remarks</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Product Details Card -->
                    <div class="card card-secondary card-outline">
                        <div class="card-header">
                            <h3 class="card-title text-white">
                                <i class="fas fa-cog"></i> Product Details
                            </h3>
                            <div class="card-tools">
                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                    <i class="fas fa-minus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label asp-for="Weight" class="control-label">
                                            <i class="fas fa-weight text-secondary"></i> Weight
                                        </label>
                                        <input asp-for="Weight" class="form-control" type="number" min="0" step="0.001" placeholder="0.000" />
                                        <span asp-validation-for="Weight" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label asp-for="WeightUnit" class="control-label">Unit</label>
                                        <select asp-for="WeightUnit" class="form-control">
                                            <option value="">Unit</option>
                                            <option value="KG">KG</option>
                                            <option value="Gram">Gram</option>
                                            <option value="Pound">Pound</option>
                                            <option value="Ton">Ton</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="Dimensions" class="control-label">
                                            <i class="fas fa-ruler text-secondary"></i> Dimensions
                                        </label>
                                        <input asp-for="Dimensions" class="form-control" placeholder="L x W x H (e.g., 10x5x3 cm)" />
                                        <span asp-validation-for="Dimensions" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label asp-for="Color" class="control-label">
                                            <i class="fas fa-palette text-secondary"></i> Color
                                        </label>
                                        <input asp-for="Color" class="form-control" placeholder="Product color" />
                                        <span asp-validation-for="Color" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label asp-for="Material" class="control-label">
                                            <i class="fas fa-industry text-secondary"></i> Material
                                        </label>
                                        <input asp-for="Material" class="form-control" placeholder="Primary material" />
                                        <span asp-validation-for="Material" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label asp-for="ShelfLife" class="control-label">
                                            <i class="fas fa-calendar-alt text-warning"></i> Shelf Life (Days)
                                        </label>
                                        <input asp-for="ShelfLife" type="number" class="form-control" min="0" />
                                        <span asp-validation-for="ShelfLife" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <div class="custom-control custom-checkbox">
                                            <input asp-for="HasExpiry" type="checkbox" class="custom-control-input" id="HasExpiry">
                                            <label class="custom-control-label" for="HasExpiry">
                                                <i class="fas fa-clock text-warning"></i> Has Expiry Date
                                            </label>
                                        </div>
                                    </div>
                                    <div class="form-group" id="ExpiryDateGroup" style="display: none;">
                                        <label asp-for="ExpiryDate" class="control-label">
                                            <i class="fas fa-calendar-times text-danger"></i> Expiry Date
                                        </label>
                                        <input asp-for="ExpiryDate" type="date" class="form-control" />
                                        <span asp-validation-for="ExpiryDate" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <div class="custom-control custom-checkbox">
                                            <input asp-for="IsHazardous" type="checkbox" class="custom-control-input" id="IsHazardous">
                                            <label class="custom-control-label" for="IsHazardous">
                                                <i class="fas fa-exclamation-triangle text-danger"></i> Hazardous Material
                                            </label>
                                        </div>
                                    </div>
                                    <div class="form-group" id="HazardClassGroup" style="display: none;">
                                        <label asp-for="HazardClass" class="control-label">
                                            <i class="fas fa-biohazard text-danger"></i> Hazard Class
                                        </label>
                                        <input asp-for="HazardClass" class="form-control" placeholder="Hazard classification" />
                                        <span asp-validation-for="HazardClass" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <div class="custom-control custom-checkbox">
                                            <input asp-for="RequiresSpecialHandling" type="checkbox" class="custom-control-input" id="RequiresSpecialHandling">
                                            <label class="custom-control-label" for="RequiresSpecialHandling">
                                                <i class="fas fa-hand-paper text-warning"></i> Requires Special Handling
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="StorageRequirements" class="control-label">
                                            <i class="fas fa-warehouse text-info"></i> Storage Requirements
                                        </label>
                                        <textarea asp-for="StorageRequirements" class="form-control" rows="2" placeholder="Special storage conditions..."></textarea>
                                        <span asp-validation-for="StorageRequirements" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="SafetyInstructions" class="control-label">
                                            <i class="fas fa-shield-alt text-success"></i> Safety Instructions
                                        </label>
                                        <textarea asp-for="SafetyInstructions" class="form-control" rows="2" placeholder="Safety handling instructions..."></textarea>
                                        <span asp-validation-for="SafetyInstructions" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="col-md-4">
                    <!-- Status Card -->
                    <div class="card card-success card-outline">
                        <div class="card-header">
                            <h3 class="card-title text-white">
                                <i class="fas fa-toggle-on"></i> Status
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <div class="custom-control custom-switch custom-switch-off-danger custom-switch-on-success">
                                    <input asp-for="IsActive" type="checkbox" class="custom-control-input" id="IsActive" checked>
                                    <label class="custom-control-label" for="IsActive">Item Status</label>
                                </div>
                                <small class="text-muted">Inactive items won't appear in transactions</small>
                            </div>
                        </div>
                    </div>

                    <!-- NEW: Image Upload Card -->
                    <div class="card card-primary card-outline">
                        <div class="card-header">
                            <h3 class="card-title text-white">
                                <i class="fas fa-image"></i> Item Image
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label for="itemImageUpload">Upload Image</label>
                                <div class="custom-file">
                                    <input type="file" class="custom-file-input" id="itemImageUpload" name="ItemImageFile" accept="image/*">
                                    <label class="custom-file-label" for="itemImageUpload">Choose file...</label>
                                </div>
                                <small class="text-muted">Supported: JPG, PNG, GIF (Max 2MB)</small>
                            </div>
                            <div id="imagePreview" class="text-center mt-3" style="display:none;">
                                <img id="previewImg" src="#" alt="Preview" class="img-fluid" style="max-height: 200px;">
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="card">
                        <div class="card-body">
                            <button type="submit" class="btn btn-success btn-block btn-lg">
                                <i class="fas fa-save"></i> Create Item
                            </button>
                            <a asp-action="Index" class="btn btn-secondary btn-block">
                                <i class="fas fa-times"></i> Cancel
                            </a>
                        </div>
                    </div>

                    <!-- Quick Help -->
                    <div class="card card-info">
                        <div class="card-header">
                            <h3 class="card-title text-white">
                                <i class="fas fa-question-circle"></i> Quick Help
                            </h3>
                            <div class="card-tools">
                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                    <i class="fas fa-minus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <small>
                                <ul class="pl-3">
                                    <li>Fields marked with <span class="text-danger">*</span> are required</li>
                                    <li>Item code will be auto-generated based on category</li>
                                    <li>Serial number for non-expendable items</li>
                                    <li>Image upload is optional but recommended</li>
                                    <li>Set minimum stock for low stock alerts</li>
                                    <li>Control type determines tracking requirements</li>
                                </ul>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</section>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        $(document).ready(function() {
            console.log('=== Create Item Form Initialized ===');

            // Initialize Select2
            $('.select2').select2({
                theme: 'bootstrap4',
                width: '100%',
                allowClear: true
            });

            // Conditional fields
            function toggleConditionalFields() {
                $('#ExpiryDateGroup').toggle($('#HasExpiry').is(':checked'));
                $('#HazardClassGroup').toggle($('#IsHazardous').is(':checked'));
            }

            toggleConditionalFields();
            $('#HasExpiry, #IsHazardous').on('change', toggleConditionalFields);

            // Image preview
            $('#itemImageUpload').on('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    // Update label
                    $(this).next('.custom-file-label').html(file.name);

                    // Show preview
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        $('#previewImg').attr('src', e.target.result);
                        $('#imagePreview').show();
                    };
                    reader.readAsDataURL(file);

                    // Validate file size (2MB)
                    if (file.size > 2097152) {
                        if (typeof toastr !== 'undefined') {
                            toastr.error('Image size must be less than 2MB');
                        }
                        $(this).val('');
                        $('#imagePreview').hide();
                    }
                }
            });

            // Category Change - Load SubCategories
            $('#CategoryId').on('change', function() {
                var categoryId = $(this).val();
                var $subCategory = $('#SubCategoryId');

                $subCategory.empty().append('<option value="">-- Select Sub Category --</option>');

                if (categoryId) {
                    $subCategory.append('<option value="">Loading...</option>');

                    $.ajax({
                        url: '@Url.Action("GetSubCategoriesByCategory", "Item")',
                        type: 'GET',
                        data: { categoryId: categoryId },
                        success: function(data) {
                            $subCategory.empty().append('<option value="">-- Select Sub Category --</option>');
                            if (data && data.length > 0) {
                                $.each(data, function(index, item) {
                                    $subCategory.append($('<option></option>')
                                        .val(item.id)
                                        .text(item.name));
                                });
                            }
                        },
                        error: function() {
                            $subCategory.empty().append('<option value="">Error loading</option>');
                            if (typeof toastr !== 'undefined') {
                                toastr.error('Failed to load subcategories');
                            }
                        }
                    });
                }
            });

            // Brand Change - Load Models
            $('#BrandId').on('change', function() {
                var brandId = $(this).val();
                var $itemModel = $('#ItemModelId');

                $itemModel.empty().append('<option value="">-- Select Model --</option>');

                if (brandId) {
                    $itemModel.append('<option value="">Loading...</option>');

                    $.ajax({
                        url: '@Url.Action("GetModelsByBrand", "Item")',
                        type: 'GET',
                        data: { brandId: brandId },
                        success: function(data) {
                            $itemModel.empty().append('<option value="">-- Select Model --</option>');
                            if (data && data.length > 0) {
                                $.each(data, function(index, item) {
                                    $itemModel.append($('<option></option>')
                                        .val(item.id)
                                        .text(item.name));
                                });
                            }
                        },
                        error: function() {
                            $itemModel.empty().append('<option value="">Error loading</option>');
                            if (typeof toastr !== 'undefined') {
                                toastr.error('Failed to load models');
                            }
                        }
                    });
                }
            });

            // Form Validation
            $('#createItemForm').on('submit', function(e) {
                $('.is-invalid').removeClass('is-invalid');

                var isValid = true;
                var errors = [];

                // Check required fields
                if (!$('#Name').val().trim()) {
                    $('#Name').addClass('is-invalid');
                    errors.push('Item name is required');
                    isValid = false;
                }

                if (!$('#CategoryId').val()) {
                    $('#CategoryId').addClass('is-invalid');
                    $('#CategoryError').text('Category is required');
                    errors.push('Category is required');
                    isValid = false;
                } else {
                    $('#CategoryId').removeClass('is-invalid');
                    $('#CategoryError').text('');
                }

                if (!$('#Type').val()) {
                    $('#Type').addClass('is-invalid');
                    errors.push('Item type is required');
                    isValid = false;
                }

                if (!$('#Unit').val()) {
                    $('#Unit').addClass('is-invalid');
                    errors.push('Unit is required');
                    isValid = false;
                }

                var minStock = parseFloat($('#MinimumStock').val());
                if (isNaN(minStock) || minStock < 0) {
                    $('#MinimumStock').addClass('is-invalid');
                    errors.push('Valid minimum stock is required');
                    isValid = false;
                }

                if (!isValid) {
                    e.preventDefault();

                    var errorHtml = '<ul class="mb-0">';
                    errors.forEach(function(error) {
                        errorHtml += '<li>' + error + '</li>';
                    });
                    errorHtml += '</ul>';

                    $('.alert-danger').html(errorHtml).show();

                    // Scroll to first error
                    var firstError = $('.is-invalid').first();
                    if (firstError.length) {
                        $('html, body').animate({
                            scrollTop: firstError.offset().top - 100
                        }, 500);
                    }

                    if (typeof toastr !== 'undefined') {
                        toastr.error('Please fix the errors and try again');
                    }
                    return false;
                }

                // Disable submit button
                var $submitBtn = $(this).find('button[type="submit"]');
                $submitBtn.prop('disabled', true)
                    .html('<i class="fas fa-spinner fa-spin"></i> Creating...');

                return true;
            });

            // Collapsible cards
            $('[data-card-widget="collapse"]').on('click', function() {
                var $card = $(this).closest('.card');
                $card.find('.card-body').slideToggle();
                $(this).find('i').toggleClass('fa-plus fa-minus');
            });

            console.log('=== Create Item Form Ready ===');
        });
    </script>

    <style>
        .is-invalid {
            border-color: #dc3545 !important;
        }

        .form-control:focus {
            border-color: #80bdff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        .select2-container--bootstrap4 .select2-selection {
            min-height: calc(1.5em + 0.75rem + 2px);
        }

        .custom-file-label::after {
            content: "Browse";
        }
    </style>
}